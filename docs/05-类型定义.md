# 步骤5：类型定义

## 🎯 任务目标

定义完整的TypeScript类型系统，确保类型安全和代码可维护性。

## 📋 具体任务

### 5.1 定义研究相关类型

**任务描述：** 定义研究流程中使用的核心数据类型。

**操作步骤：**
1. 创建`src/app/api/deep-research/types.ts`文件
2. 定义研究状态接口
3. 定义研究结果接口
4. 定义搜索相关类型

**需要定义的类型：**
- ResearchState：研究状态
- ResearchFindings：研究结果
- SearchResult：搜索结果
- Activity：活动记录
- Source：来源信息
- ModelCallOptions：模型调用选项
- ActivityTracker：活动跟踪器

**测试方法：**
- 准备创建一个`src/app/api/deep-research/__tests__/types.test.ts`文件，并在该文件中进行类型定义的单元测试
- 使用TypeScript编译器检查类型正确性：`npx tsc --noEmit`
- 验证类型之间的关联关系
- 测试类型在真实数据中的表现

### 5.2 定义API响应类型

**任务描述：** 定义API请求和响应的类型结构。

**操作步骤：**
1. 定义API请求体类型
2. 定义API响应体类型
3. 定义错误响应类型
4. 定义流式响应类型

**测试方法：**
- 准备创建一个`src/app/api/__tests__/api-types.test.ts`文件，并在该文件中进行API类型的单元测试
- 使用Postman或curl测试API端点，验证响应格式符合类型定义
- 测试错误响应的类型结构
- 验证流式响应的数据类型

### 5.3 定义组件Props类型

**任务描述：** 定义React组件的Props类型。

**操作步骤：**
1. 为每个UI组件定义Props接口
2. 定义事件处理函数类型
3. 定义样式相关类型
4. 定义表单数据类型

**测试方法：**
- 准备创建一个`src/components/__tests__/props-types.test.ts`文件，并在该文件中进行组件Props类型的单元测试
- 在组件中使用Props类型，验证TypeScript编译无错误
- 测试组件的不同Props组合
- 验证事件处理函数的类型安全

### 5.4 定义状态管理类型

**任务描述：** 定义Zustand状态管理的类型。

**操作步骤：**
1. 定义状态接口
2. 定义动作接口
3. 定义选择器类型
4. 定义中间件类型

**测试方法：**
- 准备创建一个`src/store/__tests__/store-types.test.ts`文件，并在该文件中进行状态管理类型的单元测试
- 在状态存储中使用类型，验证类型安全
- 测试状态更新方法的类型正确性
- 验证选择器函数的返回类型

### 5.5 定义工具函数类型

**任务描述：** 定义工具函数的参数和返回值类型。

**操作步骤：**
1. 定义通用工具函数类型
2. 定义数据处理函数类型
3. 定义验证函数类型
4. 定义转换函数类型

**测试方法：**
- 准备创建一个`src/lib/__tests__/utility-types.test.ts`文件，并在该文件中进行工具函数类型的单元测试
- 在工具函数中使用类型注解，验证类型正确性
- 测试函数重载的类型推断
- 验证泛型函数的类型约束

### 5.6 创建类型导出文件

**任务描述：** 创建统一的类型导出文件。

**操作步骤：**
1. 创建`src/types/index.ts`文件
2. 导出所有公共类型
3. 组织类型结构
4. 添加类型文档注释

**测试方法：**
- 准备创建一个`src/types/__tests__/index.test.ts`文件，并在该文件中进行类型导出的单元测试
- 测试类型导入和导出正确性
- 验证类型文档注释完整
- 检查类型命名规范

## ✅ 完成标准

- [ ] 研究相关类型定义完成
- [ ] API响应类型定义完成
- [ ] 组件Props类型定义完成
- [ ] 状态管理类型定义完成
- [ ] 工具函数类型定义完成
- [ ] 类型导出文件创建完成
- [ ] 所有类型测试通过

## 🔍 测试策略

**类型检查测试：**
- 使用TypeScript编译器进行类型检查
- 验证类型推断正确性
- 测试类型约束有效性

**运行时类型测试：**
- 使用zod等库进行运行时类型验证
- 测试类型转换函数
- 验证类型守卫函数

**集成类型测试：**
- 测试类型在组件中的使用
- 验证API类型与实际数据匹配
- 测试状态管理类型的正确性

## 📝 下一步

完成本步骤后，请继续 [06-问题生成API.md](./06-问题生成API.md) 实现问题生成功能。

